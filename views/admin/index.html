{{>header}}
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-6 col-md-6">
      <h2>Pending Organization Accounts</h2>
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Options</th>
          </tr>
        </thead>
        <tbody id="orgAccInfo">

        </tbody>
      </table>
    </div>
  </div>
</div>
{{>scripts}}
<script>
  $(document).ready(function() {
    loadAccounts();
  });

  function approve(datax) {
    $.ajax({
      url: '/approveOrgAcc',
      type: 'POST',
      data: datax,
      datatype: 'json',
      success: function(data) {
        loadAccounts();
      }
    });
  }

  function reject(datax) {
    $.ajax({
      url: '/approveOrgAcc',
      type: 'POST',
      data: datax,
      datatype: 'json',
      success: function(data) {
        loadAccounts();
      }
    })
  }

  function loadAccounts() {
    $('#orgAccInfo').empty();

    $.ajax({

      url: '/getOrgAccByApprove',
      type: 'GET',
      datatype: 'json',
      success: function(info) {
        for (var i = 0; i < info.length; i++) {
          $('#orgAccInfo').append('<tr><td>' + info[i].name + '</td><td>' + info[i].email +
            '</td><td><button data-id="' + info[i].email + '" class="success btn btn-success btn-xs"><span class="glyphicon glyphicon-ok"></span></button> &nbsp; <button data-id="' + info[i].email +
            '" class="denied btn btn-danger btn-xs"> <span class="glyphicon glyphicon-remove"></span></button></td></tr>'
          )
        };
        $('.success').on('click', function(e) {
          var data = {
            isOrgApproved: "true",
            email: $(this).data('id')
          };
          swal({
            title: "Approve account",
            text: "Do you wish to approve this account?",
            type: "warning",
            confirmButtonColor: "#33CC33",
            confirmButtonText: "Yes, approve it!",
            showCancelButton: true,
            cancelButtonText: "Wait, let me think.",
            closeOnConfirm: true,
            closeOnCancel: false
          }, function(isConfirm) {
            if (isConfirm) {
              approve(data);
              swal("Approved", "This account has been approved", "success");
            } else {
              swal("Cancelled", "This account is not yet approved", "success");
            }
          })
        })

        $('.denied').on('click', function(e) {
          var data = {
            isOrgApproved: "false",
            email: $(this).data('id'),
          };
          swal({
            title: "Reject account",
            text: "Do you wish to reject this account?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes, delete it!",
            cancelButtonText: "Wait, let me think.",
            closeOnConfirm: true,
            closeOnCancel: false
          }, function(isConfirm) {
            if (isConfirm) {
              reject(data);
              swal("Rejected", "This account has been deleted", "success");
            } else {
              swal("Cancelled", "This account still needs approval", "success");
            }
          })
        })
      }
    })
  };
</script>
{{>footer}}